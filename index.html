<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>–ü–æ–¥–ø–∏—Å—å –≤ Phantom</title>
</head>
<body>

<h2>–ü–æ–¥–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</h2>

<button id="connect">–ü–æ–¥–∫–ª—é—á–∏—Ç—å Phantom</button>
<br><br>
<button id="sign" disabled>–ü–æ–¥–ø–∏—Å–∞—Ç—å</button>

<p id="result" style="white-space: pre-wrap; font-family: monospace;"></p>

<script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>

<script>
const MESSAGE = `XSS ü™Ω good FORUM ü©∑ü¶≠
!!!!!! (‚âß‚àá‚â¶)`;

let wallet;
let publicKey;

document.getElementById("connect").onclick = async () => {
  if (!window.solana) {
    alert("Phantom –Ω–µ –Ω–∞–π–¥–µ–Ω");
    return;
  }

  wallet = window.solana;

  try {
    const resp = await wallet.connect();
    publicKey = resp.publicKey;
    
    document.getElementById("result").textContent = 
      "–ü–æ–¥–∫–ª—é—á–µ–Ω–æ: " + publicKey.toBase58();
      
    document.getElementById("sign").disabled = false;
  } catch (e) {
    document.getElementById("result").textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è";
  }
};

document.getElementById("sign").onclick = async () => {
  document.getElementById("result").textContent = "–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏...";

  try {
    const encoded = new TextEncoder().encode(MESSAGE);

    const signed = await wallet.request({
      method: "signMessage",
      params: {
        message: encoded,
        display: "utf8"
      }
    });

    // –ï—Å–ª–∏ –¥–æ—à–ª–∏ —Å—é–¥–∞ ‚Äî –ø–æ–¥–ø–∏—Å—å –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ
    const sig = signed.signature;
    
    const hex = Array.from(sig)
      .map(b => b.toString(16).padStart(2, "0"))
      .join("");

    const base58Sig = solanaWeb3.bs58.encode(sig);

    document.getElementById("result").innerHTML = 
      "–£–°–ü–ï–®–ù–û –ü–û–î–ü–ò–°–ê–ù–û!\n\n" +
      "–°–æ–æ–±—â–µ–Ω–∏–µ:\n" + MESSAGE + "\n\n" +
      "–ê–¥—Ä–µ—Å:\n" + publicKey.toBase58() + "\n\n" +
      "–ü–æ–¥–ø–∏—Å—å (hex):\n" + hex + "\n\n" +
      "–ü–æ–¥–ø–∏—Å—å (base58):\n" + base58Sig;

  } catch (e) {
    let msg = "–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∏";

    if (e.message && e.message.includes("User rejected")) {
      msg = "–í—ã –æ—Ç–º–µ–Ω–∏–ª–∏ –ø–æ–¥–ø–∏—Å—å –≤ –∫–æ—à–µ–ª—å–∫–µ";
    } else if (e.message) {
      msg = "–û—à–∏–±–∫–∞: " + e.message;
    }

    document.getElementById("result").textContent = msg;
    console.error(e); // –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
  }
};
</script>

</body>
</html>
